/*! VolunteerRescue | (c) 2012 - 2018 SKRPC Holdings, Inc. 
 * http://volunteerrescue.org/app_license
 */
;var stPCRE_searches;var stPCRE_AMDRs;var stPCRE_saveClickHandler=function(a){var d=volunteerRescue.checkFields(a,"stPCRE_");var c=stPCRE_searches[g_pageParams.searchUUID];var e;var b;if(d==true){if(g_pageParams.regionId==-1){e="r"+c.nextRegionId++;c.regionCount++;for(b in c.evaluators){c.evaluators[b].regions[e]=0}c.results.regions[e]={subTotal:0,POA:0,ESW:0,POD:Number(Number(c.POD/100).toFixed(2)),area:0,searcherSpeed:0,PDen:0,trackSpacing:0,POS:0,PSR:0,effort:0,areaSwept:0,coverage:0,searchersAvailable:c.searchersAvailable,hoursAvailable:c.hoursAvailable}}else{e=g_pageParams.regionId}c.results.regions[e].ESW=Number($("#stPCRE_ESW").val());c.results.regions[e].area=Number($("#stPCRE_area").val());c.results.regions[e].searcherSpeed=Number($("#stPCRE_searcher_speed").val());c.regions[e]={description:$("#stPCRE_description").val(),area:Number($("#stPCRE_area").val()),AMDRs:[],ESW:Number($("#stPCRE_ESW").val()),searcherSpeed:Number($("#stPCRE_searcher_speed").val())};$('input[id^="stPCRE_AMDR-"]').each(function(){if($(this).prop("checked")){c.regions[e].AMDRs[c.regions[e].AMDRs.length]=$(this).attr("id").substr(12)}});c.regions=volunteerRescue.sortAssociative(c.regions);volunteerRescue.searchProbabilityCalculator(c,null);vr_device.localStorage.setItem("stSearches",JSON.stringify(stPCRE_searches));window.history.back()}return false};var stPCRE_deleteClickHandler=function(){volunteerRescue.confirmationDialog("Are you sure you want to delete the region from the search ?",function(){var b=stPCRE_searches[g_pageParams.searchUUID];for(var a in b.evaluators){delete b.evaluators[a].regions[g_pageParams.regionId]}delete b.results.regions[g_pageParams.regionId];delete b.regions[g_pageParams.regionId];b.regionCount--;volunteerRescue.searchProbabilityCalculator(b,null);vr_device.localStorage.setItem("stSearches",JSON.stringify(stPCRE_searches));window.history.back()},function(){});return false};stPCRE_changeAMDR=function(){var c=$('[id^="stPCRE_AMDR-"]:checked');var b;var a;if(c.length>0){b=0;for(a=0;a<c.length;a++){b+=Number($(c[a]).attr("data-vr-metres"))}$("#stPCRE_ESW").val(Number(b/c.length).toFixed(1)).prop("disabled",true)}else{$("#stPCRE_ESW").prop("disabled",false)}};$("#stPCRE_page").on("pageshow",function(){var a;var c;var b;var d={description:{value:"",required:true},ESW:{value:"1",required:true},area:{value:"1",required:true},searcher_speed:{value:"1",required:true}};vr_device.googleAnalytics();g_pageParams=JSON.parse(window.sessionStorage.getItem("stPCS_pageParams"));stPCRE_searches=vr_device.localStorage.getItem("stSearches");if(stPCRE_searches){stPCRE_searches=JSON.parse(stPCRE_searches)}if(!g_pageParams||!stPCRE_searches||!stPCRE_searches[g_pageParams.searchUUID]||(g_pageParams.regionId!=-1&&!stPCRE_searches[g_pageParams.searchUUID].regions[g_pageParams.regionId])){window.history.back()}else{$("img#stPCRE_online").attr("src",(g_onLine==true?g_basePath+"images/online.png":g_basePath+"images/offline.png"));$("#stPCRE_pageTitle").text(g_pageParams.description+" - Region");stPCRE_AMDRs=vr_device.localStorage.getItem("stAMDRs");$("#stPCRE_fieldsetAMDRs input:checkbox").remove();$("#stPCRE_fieldsetAMDRs label").remove();$("#stPCRE_fieldsetAMDRs p").remove();AMDRs=$("#stPCRE_fieldsetAMDRs");if(stPCRE_AMDRs&&stPCRE_AMDRs!="{}"){stPCRE_AMDRs=JSON.parse(stPCRE_AMDRs);for(a in stPCRE_AMDRs){AMDRs.append($("<label>").attr({"for":"stPCRE_AMDR-"+a}).text(stPCRE_AMDRs[a].description)).append($("<input>").attr({id:"stPCRE_AMDR-"+a,name:"stPCRE_AMDR-"+a,type:"checkbox","data-vr-metres":stPCRE_AMDRs[a].amdrMetres}).change(stPCRE_changeAMDR))}}else{AMDRs.append($("<p>").text("None created"))}$("#stPCRE_divAMDRs").trigger("create");if(g_pageParams.regionId!=-1){c=stPCRE_searches[g_pageParams.searchUUID].regions[g_pageParams.regionId];d.description.value=c.description;d.ESW.value=c.ESW;d.area.value=c.area;d.searcher_speed.value=c.searcherSpeed;for(a in c.AMDRs){$("#stPCRE_AMDR-"+c.AMDRs[a]).prop("checked",true).checkboxradio("refresh",true)}if(stPCRE_searches[g_pageParams.searchUUID].completedSearches.length==0){b=false;$("#stPCRE_submitForm").css("display","inline-block");$("#stPCRE_deleteForm").css("display","inline-block")}else{b=true;$("#stPCRE_submitForm").css("display","none");$("#stPCRE_deleteForm").css("display","none")}}else{b=false;$("#stPCRE_submitForm").css("display","inline-block");$("#stPCRE_deleteForm").css("display","none")}$("#stPCRE_description").prop("disabled",b);$("#stPCRE_ESW").prop("disabled",b==false?g_pageParams.regionId!=-1&&c.AMDRs.length>0:true);$("#stPCRE_area").prop("disabled",b);$("#stPCRE_searcher_speed").prop("disabled",b);volunteerRescue.populateFields(d,"stPCRE_");$("#stPCRE_AMDR").selectmenu("refresh",true);$("#stPCRE_deleteForm").off("click",stPCRE_deleteClickHandler).on("click",stPCRE_deleteClickHandler);$("#stPCRE_submitForm").off("click",stPCRE_saveClickHandler).on("click",{apiResponse:d},stPCRE_saveClickHandler);$("#stPCRE_form").submit({apiResponse:d},stPCRE_saveClickHandler)}});