/*! VolunteerRescue | (c) 2012 - 2018 SKRPC Holdings, Inc. 
 * http://volunteerrescue.org/app_license
 */
;var stPRH_searches;var stPRH_lastPOA;var stPRH_saveClickHandler=function(){vr_device.localStorage.setItem("stSearches",JSON.stringify(stPRH_searches));window.history.back();return false};stPRH_changeESW=function(a){stPRH_searches[g_pageParams.searchUUID].results.regions[a.data.region].ESW=$(this).val()<=0?1:Number($(this).val());stPRH_updateDisplay(a.data.region,stPRH_lastPOA[a.data.region].POA,null,null)};stPRH_changeSearcherSpeed=function(a){stPRH_searches[g_pageParams.searchUUID].results.regions[a.data.region].searcherSpeed=$(this).val()<=0?1:Number($(this).val());stPRH_updateDisplay(a.data.region,stPRH_lastPOA[a.data.region].POA,null,null)};stPRH_changeArea=function(a){stPRH_searches[g_pageParams.searchUUID].results.regions[a.data.region].area=$(this).val()<=0?1:Number($(this).val());stPRH_updateDisplay(a.data.region,stPRH_lastPOA[a.data.region].POA,null,null)};stPRH_changePOD=function(a){if($(this).val()<=0){$(this).val(1)}stPRH_updateDisplay(a.data.region,stPRH_lastPOA[a.data.region].POA,null,Number(Number($(this).val()/100).toFixed(2)))};stPRH_changeCoverage=function(a){if($(this).val()<=0){$(this).val(1)}stPRH_updateDisplay(a.data.region,stPRH_lastPOA[a.data.region].POA,$(this).val(),null)};stPRH_changeSearchersAvailable=function(a){stPRH_searches[g_pageParams.searchUUID].results.regions[a.data.region].searchersAvailable=Number($(this).val());if($(this).val()<=0){$(this).val(1)}stPRH_calculateRequired(Number($(this).val()),"#stPRH_cellHR-"+a.data.region,a.data.region,false)};stPRH_changeHoursAvailable=function(a){stPRH_searches[g_pageParams.searchUUID].results.regions[a.data.region].hoursAvailable=Number($(this).val());if($(this).val()<=0){$(this).val(1)}stPRH_calculateRequired(Number($(this).val()),"#stPRH_cellSR-"+a.data.region,a.data.region,true)};stPRH_changeAllInOneOp=function(a){var g=Number($("#stPRH_inputOneOpSearchers").val());var f=Number($("#stPRH_inputOneOpHours").val());var b=g*f;var c=stPRH_searches[g_pageParams.searchUUID].regions;var e=stPRH_searches[g_pageParams.searchUUID].results.regions;var k,h,j;var d;for(d in c){k=b*e[d].searcherSpeed;h=e[d].ESW*k/1000/e[d].area;j=1-Math.pow(Math.E,h*-1);$("#stPRH_cellOpEffort-"+d).text(Number(k).toFixed(2));$("#stPRH_cellOpCoverage-"+d).text(Number(h).toFixed(2));$("#stPRH_cellOpPOD-"+d).text(Number(j*100).toFixed(2));$("#stPRH_cellOpPOS-"+d).text(Number(j*stPRH_lastPOA[d].POA).toFixed(2))}};stPRH_updateDisplay=function(g,a,f,h){var e=stPRH_searches[g_pageParams.searchUUID].regions[g];var k=stPRH_searches[g_pageParams.searchUUID].results.regions[g];var b,c,j,d;volunteerRescue.regionProbabilityCalculator(e,k,a,f,h);$("#stPRH_inputESW-"+g).val(k.ESW);$("#stPRH_inputArea-"+g).val(k.area);$("#stPRH_inputSS-"+g).val(k.searcherSpeed);$("#stPRH_inputPOD-"+g).val(Number(k.POD*100).toFixed(0));$("#stPRH_inputCoverage-"+g).val(k.coverage);$("#stPRH_cellTS-"+g).text(k.trackSpacing);$("#stPRH_cellEffort-"+g).text(k.effort);$("#stPRH_cellAreaSwept-"+g).text(k.areaSwept);$("#stPRH_cellPDen-"+g).text(k.PDen);$("#stPRH_cellPOS-"+g).text(k.POS);$("#stPRH_cellPSR-"+g).text(k.PSR);c=0;j=0;d=0;for(b in stPRH_searches[g_pageParams.searchUUID].regions){if(stPRH_searches[g_pageParams.searchUUID].results.regions[b].PDen>c){c=stPRH_searches[g_pageParams.searchUUID].results.regions[b].PDen}if(stPRH_searches[g_pageParams.searchUUID].results.regions[b].POS>j){j=stPRH_searches[g_pageParams.searchUUID].results.regions[b].POS}if(stPRH_searches[g_pageParams.searchUUID].results.regions[b].PSR>d){d=stPRH_searches[g_pageParams.searchUUID].results.regions[b].PSR}}$('[id^="stPRH_cellPDen-"]').removeClass("vr-cell-highest");$('[id^="stPRH_cellPDen-"]:contains("'+c+'")').addClass("vr-cell-highest");$('[id^="stPRH_cellPOS-"]').removeClass("vr-cell-highest");$('[id^="stPRH_cellPOS-"]:contains("'+j+'")').addClass("vr-cell-highest");$('[id^="stPRH_cellPSR-"]').removeClass("vr-cell-highest");$('[id^="stPRH_cellPSR-"]:contains("'+d+'")').addClass("vr-cell-highest");stPRH_calculateRequired(k.searchersAvailable,"#stPRH_cellHR-"+g,g,false);stPRH_calculateRequired(k.hoursAvailable,"#stPRH_cellSR-"+g,g,true);stPRH_changeAllInOneOp()};stPRH_calculateRequired=function(c,a,e,b){var d;if(c>0){region=stPRH_searches[g_pageParams.searchUUID].regions[e];result=stPRH_searches[g_pageParams.searchUUID].results.regions[e];d=Number(result.area*result.coverage/(result.ESW/1000)/result.searcherSpeed/c).toFixed(2);$(a).text(b==true?Math.ceil(d):d)}else{$(a).html("&nbsp;")}};stPRH_buildResults=function(c,C,u){var l,A,y;var h=[];var I=[];var H=[];var r;var K;var p;var g;var z;var B;var s;var t;var n;var x;var a;var G;var q;var J;var e;var w;var f;var k;var m;var d;var b;var v;var E;var F;var o;var D;h[0]=$("<tr>").append($("<th>").css("padding","0.75em 0").text("Region"));h[1]=$("<tr>").append($("<th>").css("padding","0.75em 0").text("Region"));h[2]=$("<tr>").append($("<th>").css("padding","0.75em 0").text("Region"));r=$("<tr>").append($("<th>").text("Sub total"));K=$("<tr>").append($("<th>").text("Probability of area (%)"));for(A in stPRH_searches[g_pageParams.searchUUID].completedSearches){I[A]=$("<tr>").append($("<th>").text(stPRH_searches[g_pageParams.searchUUID].completedSearches[A].description+" POA (%)"));H[A]=0}p=$("<tr>").append($("<th>").text("Ranking by POA"));g=$("<tr>").append($("<th>").html("Area (km&sup2;)"));z=$("<tr>").append($("<th>").html("Probability density (%/km&sup2;)"));B=$("<tr>").append($("<th>").text("Effective sweep width (m)"));s=$("<tr>").append($("<th>").text("Searcher speed (km/h)"));t=$("<tr>").append($("<th>").text("Coverage (x)"));n=$("<tr>").append($("<th>").css({"font-size":"1.25em","font-weight":"bold",padding:"0.75em 0"}).text("Track spacing (m)"));x=$("<tr>").append($("<th>").text("Effort (km)"));a=$("<tr>").append($("<th>").html("Area effectively swept (km&sup2;)"));G=$("<tr>").append($("<th>").text("Probability of detection (%)"));q=$("<tr>").append($("<th>").text("Probability of success (%)"));J=$("<tr>").append($("<th>").text("Probable success rate"));e=$("<tr>").append($("<th>").text("Searchers available"));w=$("<tr>").append($("<th>").text("Hours required"));f=$("<tr>").append($("<th>").text("Hours available"));k=$("<tr>").append($("<th>").text("Searchers required"));m=$("<tr>").append($("<th>").text("Effort available (km)"));d=$("<tr>").append($("<th>").text("Coverage of (x)"));b=$("<tr>").append($("<th>").text("Probability of detection of (%)"));v=$("<tr>").append($("<th>").text("Probability of success of (%)"));E=0;F=0;o=0;D=0;for(A in c){h[0].append($("<th>").text(c[A].description));h[1].append($("<th>").text(c[A].description));h[2].append($("<th>").text(c[A].description));r.append($("<td>").text(u.regions[A].subTotal));K.append($("<td>").attr("id","stPRH_cellPOA-"+A).text(u.regions[A].POA));p.append($("<td>").attr("id","stPRH_cellRankingPOA-"+A).text(stPRH_searches[g_pageParams.searchUUID].results.rankingPOA[A]));if(stPRH_searches[g_pageParams.searchUUID].completedSearches.length>0){for(y in stPRH_searches[g_pageParams.searchUUID].completedSearches){I[y].append($("<td>").attr("id","stPRH_cell-"+y+"-POA-"+A).text(stPRH_searches[g_pageParams.searchUUID].completedSearches[y].regions[A].POA));if(stPRH_searches[g_pageParams.searchUUID].completedSearches[y].regions[A].POA>H[y]){H[y]=stPRH_searches[g_pageParams.searchUUID].completedSearches[y].regions[A].POA}}stPRH_lastPOA=stPRH_searches[g_pageParams.searchUUID].completedSearches[y].regions}else{stPRH_lastPOA=u.regions}z.append($("<td>").attr("id","stPRH_cellPDen-"+A).text(u.regions[A].PDen));n.append($("<td>").attr("id","stPRH_cellTS-"+A).css({"font-size":"1.25em","font-weight":"bold"}).text(u.regions[A].trackSpacing));x.append($("<td>").attr("id","stPRH_cellEffort-"+A).text(u.regions[A].effort));a.append($("<td>").attr("id","stPRH_cellAreaSwept-"+A).text(u.regions[A].areaSwept));q.append($("<td>").attr("id","stPRH_cellPOS-"+A).text(u.regions[A].POS));J.append($("<td>").attr("id","stPRH_cellPSR-"+A).text(u.regions[A].PSR));B.append($("<td>").html($("<input>").attr({id:"stPRH_inputESW-"+A,type:"number",value:u.regions[A].ESW,min:0.5,max:999,step:"0.5",size:5,maxlength:5}).on("change",{region:A},stPRH_changeESW)));s.append($("<td>").html($("<input>").attr({id:"stPRH_inputSS-"+A,type:"number",value:u.regions[A].searcherSpeed,min:0.1,max:999,step:"0.1",size:5,maxlength:5}).on("change",{region:A},stPRH_changeSearcherSpeed)));g.append($("<td>").html($("<input>").attr({id:"stPRH_inputArea-"+A,type:"number",value:u.regions[A].area,min:0.1,max:999,step:"0.1",size:5,maxlength:5}).on("change",{region:A},stPRH_changeArea)));G.append($("<td>").html($("<input>").attr({id:"stPRH_inputPOD-"+A,type:"number",value:u.regions[A].POD*100,min:1,max:100,step:"1",size:5,maxlength:5}).on("change",{region:A},stPRH_changePOD)));t.append($("<td>").html($("<input>").attr({id:"stPRH_inputCoverage-"+A,type:"number",value:u.regions[A].coverage,min:0.1,max:999,step:"0.1",size:5,maxlength:5}).on("change",{region:A},stPRH_changeCoverage)));e.append($("<td>").html($("<input>").attr({id:"stPRH_inputSA-"+A,type:"number",value:u.regions[A].searchersAvailable,min:1,max:999,step:"1",size:5,maxlength:5}).on("change",{region:A},stPRH_changeSearchersAvailable)));w.append($("<td>").attr("id","stPRH_cellHR-"+A).html("&nbsp;"));f.append($("<td>").html($("<input>").attr({id:"stPRH_inputHA-"+A,type:"number",value:u.regions[A].hoursAvailable,min:1,max:999,step:"0.5",size:5,maxlength:5}).on("change",{region:A},stPRH_changeHoursAvailable)));k.append($("<td>").attr("id","stPRH_cellSR-"+A).html("&nbsp;"));m.append($("<td>").attr("id","stPRH_cellOpEffort-"+A).html("&nbsp;"));d.append($("<td>").attr("id","stPRH_cellOpCoverage-"+A).html("&nbsp;"));b.append($("<td>").attr("id","stPRH_cellOpPOD-"+A).html("&nbsp;"));v.append($("<td>").attr("id","stPRH_cellOpPOS-"+A).html("&nbsp;"));if(u.regions[A].POA>E){E=u.regions[A].POA}if(u.regions[A].PDen>F){F=u.regions[A].PDen}if(u.regions[A].POS>o){o=u.regions[A].POS}if(u.regions[A].PSR>D){D=u.regions[A].PSR}}$("#stPRH_theadResults").empty().append(h[0]);$("#stPRH_tbodyResults").empty();for(y in C){l=$("<tr>").append($("<th>").text(C[y].description));for(A in c){l.append($("<td>").text(C[y].regions[A]))}$("#stPRH_tbodyResults").append(l)}$("#stPRH_tbodyResults").append(r).append(K);for(A in stPRH_searches[g_pageParams.searchUUID].completedSearches){$("#stPRH_tbodyResults").append(I[A])}$("#stPRH_tbodyResults").append(p).append(h[1]).append(B).append(G).append(t).append(n).append(g).append(s).append(x).append(a).append(z).append(q).append(J).append(h[2]).append(e).append(w).append(f).append(k).append($("<tr>").append($("<td>").css("text-align","left").attr({colspan:1+stPRH_searches[g_pageParams.searchUUID].regionCount}).append($("<div>").html("What if all searchers are in one region for one operational period")).append($("<div>").append($("<label>").css("padding-right","1em").attr({"for":"stPRH_inputOneOpSearcher-"+A}).text("Number of searchers")).append($("<input>").attr({id:"stPRH_inputOneOpSearchers",type:"number",value:0,min:1,max:999,step:"1",size:5,maxlength:5}).change(stPRH_changeAllInOneOp))).append($("<div>").append($("<label>").css("padding-right","1em").attr({"for":"stPRH_inputOneOpHours-"+A}).text("Number of hours")).append($("<input>").attr({id:"stPRH_inputOneOpHours",type:"number",value:0,min:1,max:999,step:"0.5",size:5,maxlength:5}).change(stPRH_changeAllInOneOp))))).append(m).append(d).append(b).append(v);$('[id^="stPRH_cellPOA-"]:contains("'+E+'")').addClass("vr-cell-highest");$('[id^="stPRH_cellPDen-"]:contains("'+F+'")').addClass("vr-cell-highest");$('[id^="stPRH_cellPOS-"]:contains("'+o+'")').addClass("vr-cell-highest");$('[id^="stPRH_cellPSR-"]:contains("'+D+'")').addClass("vr-cell-highest");for(A in stPRH_searches[g_pageParams.searchUUID].completedSearches){$('[id^="stPRH_cell-'+A+'-POA-"]:contains("'+H[A]+'")').addClass("vr-cell-highest")}for(A in c){stPRH_calculateRequired(u.regions[A].searchersAvailable,"#stPRH_cellHR-"+A,A,false);stPRH_calculateRequired(u.regions[A].hoursAvailable,"#stPRH_cellSR-"+A,A,true)}};$("#stPRH_page").on("pageshow",function(a,b){vr_device.googleAnalytics();$("img#stPRH_online").attr("src",(g_onLine==true?g_basePath+"images/online.png":g_basePath+"images/offline.png"));g_pageParams=JSON.parse(window.sessionStorage.getItem("stPCS_pageParams"));stPRH_searches=vr_device.localStorage.getItem("stSearches");if(stPRH_searches){stPRH_searches=JSON.parse(stPRH_searches)}if(!stPRH_searches||!g_pageParams||!stPRH_searches[g_pageParams.searchUUID]){window.history.back()}else{$("#stPRH_pageTitle").text(g_pageParams.description+" - Results");stPRH_buildResults(stPRH_searches[g_pageParams.searchUUID].regions,stPRH_searches[g_pageParams.searchUUID].evaluators,stPRH_searches[g_pageParams.searchUUID].results,null);volunteerRescue.touchScroll("stPRH_divResults");$("#stPRH_submitForm").off("click",stPRH_saveClickHandler).on("click",stPRH_saveClickHandler);$("#stPRH_form").submit(stPRH_saveClickHandler)}});