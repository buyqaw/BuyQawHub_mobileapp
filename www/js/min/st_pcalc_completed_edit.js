/*! VolunteerRescue | (c) 2012 - 2018 SKRPC Holdings, Inc. 
 * http://volunteerrescue.org/app_license
 */
;var stPCCE_searches;var stPCCE_completedSearch;var stPCCE_saveClickHandler=function(a){var b;var c=volunteerRescue.checkFields(a,"stPCCE_");if(c==true){b=g_pageParams.completedOffset!=-1?g_pageParams.completedOffset:stPCCE_searches[g_pageParams.searchUUID].completedSearches.length;stPCCE_completedSearch.description=$("#stPCCE_description").val();stPCCE_searches[g_pageParams.searchUUID].completedSearches[b]=stPCCE_completedSearch;volunteerRescue.searchProbabilityCalculator(stPCCE_searches[g_pageParams.searchUUID],stPCCE_completedSearch.regions);vr_device.localStorage.setItem("stSearches",JSON.stringify(stPCCE_searches));window.history.back()}return false};var stPCCE_deleteClickHandler=function(){volunteerRescue.confirmationDialog("Are you sure you want to delete the completed search ?",function(){stPCCE_searches[g_pageParams.searchUUID].completedSearches.splice(g_pageParams.completedOffset,1);if(stPCCE_searches[g_pageParams.searchUUID].completedSearches.length==0){volunteerRescue.searchProbabilityCalculator(stPCCE_searches[g_pageParams.searchUUID],null)}else{volunteerRescue.searchProbabilityCalculator(stPCCE_searches[g_pageParams.searchUUID],stPCCE_searches[g_pageParams.searchUUID].completedSearches[stPCCE_searches[g_pageParams.searchUUID].completedSearches.length-1].regions)}vr_device.localStorage.setItem("stSearches",JSON.stringify(stPCCE_searches));window.history.back()},function(){});return false};stPCCE_changeSearchers=function(a){stPCCE_completedSearch.regions[a.data.region].searchers=Number($(this).val());stPCCE_calculateRegion(stPCCE_completedSearch.regions[a.data.region],a.data.region)};stPCCE_changeHours=function(a){stPCCE_completedSearch.regions[a.data.region].hours=Number($(this).val());stPCCE_calculateRegion(stPCCE_completedSearch.regions[a.data.region],a.data.region)};stPCCE_changeESW=function(a){stPCCE_completedSearch.regions[a.data.region].ESW=stPCCE_searches[g_pageParams.searchUUID].results.regions[a.data.region].ESW=Number($(this).val());stPCCE_calculateRegion(stPCCE_completedSearch.regions[a.data.region],a.data.region)};stPCCE_changeSearcherSpeed=function(a){stPCCE_completedSearch.regions[a.data.region].searcherSpeed=stPCCE_searches[g_pageParams.searchUUID].results.regions[a.data.region].searcherSpeed=Number($(this).val());stPCCE_calculateRegion(stPCCE_completedSearch.regions[a.data.region],a.data.region)};stPCCE_calculateRegion=function(c,b){var a;if(g_pageParams.completedOffset==-1){a=stPCCE_searches[g_pageParams.searchUUID].completedSearches.length==0?stPCCE_searches[g_pageParams.searchUUID].results.regions[b].POA:stPCCE_searches[g_pageParams.searchUUID].completedSearches[stPCCE_searches[g_pageParams.searchUUID].completedSearches.length-1].regions[b].POA}else{a=stPCCE_searches[g_pageParams.searchUUID].completedSearches.length==1?stPCCE_searches[g_pageParams.searchUUID].results.regions[b].POA:stPCCE_searches[g_pageParams.searchUUID].completedSearches[stPCCE_searches[g_pageParams.searchUUID].completedSearches.length-2].regions[b].POA}stPCCE_completedSearch.POScum-=c.POS;c.totalHours=Number(Number(c.searchers*c.hours).toFixed(2));c.effort=Number(Number(c.searchers*c.hours*c.searcherSpeed).toFixed(2));c.coverage=Number(Number(c.ESW*c.effort/1000/c.area).toFixed(2));c.trackSpacing=c.coverage!=0?Number(Number(c.ESW/c.coverage).toFixed(2)):0;c.areaSwept=Number(Number(c.ESW*c.effort/1000).toFixed(2));c.POD=Number(Number(1-Math.pow(Math.E,c.coverage*-1)).toFixed(4));c.POA=Number(Number(a*(1-c.POD)).toFixed(2));c.POS=Number(Number(a-c.POA).toFixed(2));stPCCE_completedSearch.POScum=Number(Number(stPCCE_completedSearch.POScum+c.POS).toFixed(2));$("#stPCCE_cellTotalHours-"+b).text(c.totalHours);$("#stPCCE_cellCoverage-"+b).text(c.coverage);$("#stPCCE_cellTrackSpacing-"+b).text(c.trackSpacing);$("#stPCCE_cellEffort-"+b).text(c.effort);$("#stPCCE_cellAreaSwept-"+b).text(c.areaSwept);$("#stPCCE_cellPOD-"+b).text(Number(c.POD*100).toFixed(2));$("#stPCCE_cellPOA-"+b).text(c.POA);$("#stPCCE_cellPOS-"+b).text(c.POS);$("#stPCCE_cellPOScum").text(stPCCE_completedSearch.POScum)};stPCCE_buildResults=function(){var f;var l=[];var m;var p;var k;var o;var n;var c;var j;var b;var g;var d;var e;var h;var a;l[0]=$("<tr>").append($("<th>").css("padding","0.75em 0").text("Region"));m=$("<tr>").append($("<th>").text("Number of searchers"));p=$("<tr>").append($("<th>").text("Number of hours"));k=$("<tr>").append($("<th>").text("Effective sweep width (m)"));o=$("<tr>").append($("<th>").text("Searcher speed (km/h)"));n=$("<tr>").append($("<th>").text("Total hours"));c=$("<tr>").append($("<th>").text("Coverage (x)"));j=$("<tr>").append($("<th>").text("Track spacing (m)"));b=$("<tr>").append($("<th>").text("Effort (km)"));g=$("<tr>").append($("<th>").html("Area effectively swept (km&sup2;)"));d=$("<tr>").append($("<th>").text("Probability of detection (%)"));e=$("<tr>").append($("<th>").text("New probability of area (%)"));h=$("<tr>").append($("<th>").text("Probability of success (%)"));a=$("<tr>").append($("<th>").text("Cumulative POS (%)"));for(f in stPCCE_searches[g_pageParams.searchUUID].regions){l[0].append($("<th>").text(stPCCE_searches[g_pageParams.searchUUID].regions[f].description));if(g_pageParams.completedOffset==-1||stPCCE_searches[g_pageParams.searchUUID].completedSearches.length==Number(g_pageParams.completedOffset)+1){m.append($("<td>").html($("<input>").attr({id:"stPCCE_inputSA-"+f,type:"number",value:stPCCE_completedSearch.regions[f].searchers,min:0,max:999,step:"1",size:5,maxlength:5}).on("change",{region:f},stPCCE_changeSearchers)));p.append($("<td>").html($("<input>").attr({id:"stPCCE_inputHA-"+f,type:"number",value:stPCCE_completedSearch.regions[f].hours,min:0,max:999,step:"0.5",size:5,maxlength:5}).on("change",{region:f},stPCCE_changeHours)));k.append($("<td>").html($("<input>").attr({id:"stPCCE_inputESW-"+f,type:"number",value:stPCCE_completedSearch.regions[f].ESW,min:0,max:999,step:"0.5",size:5,maxlength:5}).on("change",{region:f},stPCCE_changeESW)));o.append($("<td>").html($("<input>").attr({id:"stPCCE_inputSS-"+f,type:"number",value:stPCCE_completedSearch.regions[f].searcherSpeed,min:0,max:999,step:"0.1",size:5,maxlength:5}).on("change",{region:f},stPCCE_changeSearcherSpeed)))}else{m.append($("<td>").css("padding","0 1.5em").text(stPCCE_completedSearch.regions[f].searchers));p.append($("<td>").text(stPCCE_completedSearch.regions[f].hours));k.append($("<td>").text(stPCCE_completedSearch.regions[f].ESW));o.append($("<td>").text(stPCCE_completedSearch.regions[f].searcherSpeed))}n.append($("<td>").attr("id","stPCCE_cellTotalHours-"+f).text(stPCCE_completedSearch.regions[f].totalHours));c.append($("<td>").attr("id","stPCCE_cellCoverage-"+f).text(stPCCE_completedSearch.regions[f].coverage));j.append($("<td>").attr("id","stPCCE_cellTrackSpacing-"+f).text(stPCCE_completedSearch.regions[f].trackSpacing));b.append($("<td>").attr("id","stPCCE_cellEffort-"+f).text(stPCCE_completedSearch.regions[f].effort));g.append($("<td>").attr("id","stPCCE_cellAreaSwept-"+f).text(stPCCE_completedSearch.regions[f].areaSwept));d.append($("<td>").attr("id","stPCCE_cellPOD-"+f).text(Number(stPCCE_completedSearch.regions[f].POD*100).toFixed(2)));e.append($("<td>").attr("id","stPCCE_cellPOA-"+f).text(stPCCE_completedSearch.regions[f].POA));h.append($("<td>").attr("id","stPCCE_cellPOS-"+f).text(stPCCE_completedSearch.regions[f].POS))}a.append($("<td>").css({"text-align":"left","padding-left":"1.5em"}).attr({id:"stPCCE_cellPOScum",colspan:stPCCE_searches[g_pageParams.searchUUID].regionCount}).text(stPCCE_completedSearch.POScum));$("#stPCCE_theadResults").empty().append(l[0]);$("#stPCCE_tbodyResults").empty();$("#stPCCE_tbodyResults").append(m).append(p).append(k).append(o).append(n).append(c).append(j).append(b).append(g).append(d).append(e).append(h).append(a)};$("#stPCCE_page").on("pageshow",function(c,d){var e={description:{value:"",required:true}};var b;var a;vr_device.googleAnalytics();$("img#stPCCE_online").attr("src",(g_onLine==true?g_basePath+"images/online.png":g_basePath+"images/offline.png"));g_pageParams=JSON.parse(window.sessionStorage.getItem("stPCS_pageParams"));stPCCE_searches=vr_device.localStorage.getItem("stSearches");if(stPCCE_searches){stPCCE_searches=JSON.parse(stPCCE_searches)}if(!stPCCE_searches||!g_pageParams||!stPCCE_searches[g_pageParams.searchUUID]){window.history.back()}else{$("#stPCCE_pageTitle").text(g_pageParams.description+" - Completed search");if(g_pageParams.completedOffset==-1){stPCCE_completedSearch={description:null,POScum:0,regions:{}};a=stPCCE_searches[g_pageParams.searchUUID].completedSearches.length==0?stPCCE_searches[g_pageParams.searchUUID].results.regions:stPCCE_searches[g_pageParams.searchUUID].completedSearches[stPCCE_searches[g_pageParams.searchUUID].completedSearches.length-1].regions;for(b in stPCCE_searches[g_pageParams.searchUUID].regions){stPCCE_completedSearch.regions[b]={searchers:0,hours:0,ESW:stPCCE_searches[g_pageParams.searchUUID].results.regions[b].ESW,searcherSpeed:stPCCE_searches[g_pageParams.searchUUID].results.regions[b].searcherSpeed,area:stPCCE_searches[g_pageParams.searchUUID].results.regions[b].area,totalHours:0,coverage:0,trackSpacing:0,effort:0,areaSwept:0,POD:0,POA:a[b].POA,POS:0}}$("#stPCCE_description").prop("disabled",false);$("#stPCCE_submitForm").css("display","inline-block");$("#stPCCE_deleteForm").css("display","none")}else{stPCCE_completedSearch=stPCCE_searches[g_pageParams.searchUUID].completedSearches[g_pageParams.completedOffset];e.description.value=stPCCE_completedSearch.description;if(stPCCE_searches[g_pageParams.searchUUID].completedSearches.length==Number(g_pageParams.completedOffset)+1){$("#stPCCE_description").prop("disabled",false);$("#stPCCE_submitForm").css("display","inline-block");$("#stPCCE_deleteForm").css("display","inline-block")}else{$("#stPCCE_description").prop("disabled",true);$("#stPCCE_submitForm").css("display","none");$("#stPCCE_deleteForm").css("display","none")}}volunteerRescue.populateFields(e,"stPCCE_");stPCCE_buildResults();volunteerRescue.touchScroll("stPCCE_divResults");$("#stPCCE_deleteForm").off("click",stPCCE_deleteClickHandler).on("click",stPCCE_deleteClickHandler);$("#stPCCE_submitForm").off("click",stPCCE_saveClickHandler).on("click",{apiResponse:e},stPCCE_saveClickHandler);$("#stPCCE_form").submit({apiResponse:e},stPCCE_saveClickHandler)}});