/*! VolunteerRescue | (c) 2012 - 2018 SKRPC Holdings, Inc. 
 * http://volunteerrescue.org/app_license
 */
;var manWE_map=null;var manWE_centerMap=true;var manWE_ptOne;var manWE_mkrOne;var manWE_points;var manWE_saveClickHandler=function(a){var b=volunteerRescue.checkFields(a,"manWE_");if(b==true){manWE_points[g_pageParams.pointUUID]={description:$("#manWE_description").val(),lat:manWE_ptOne.lat(),lon:manWE_ptOne.lon()};manWE_points=volunteerRescue.sortAssociative(manWE_points);vr_device.localStorage.setItem("manWayPoints",JSON.stringify(manWE_points));window.history.back()}return false};var manWE_deleteClickHandler=function(){volunteerRescue.confirmationDialog("Are you sure you want to delete the way point from the list ?",function(){delete manWE_points[g_pageParams.pointUUID];vr_device.localStorage.setItem("manWayPoints",JSON.stringify(manWE_points));window.history.back()},function(){});return false};$("#manWE_page").on("pageshow",function(){var a={description:{value:"",required:true}};vr_device.googleAnalytics();if(g_onLine==false){$("#manCC_divOffline").css("display","block")}g_pageParams=JSON.parse(window.sessionStorage.getItem("manW_pageParams"));manWE_points=vr_device.localStorage.getItem("manWayPoints");if(manWE_points){manWE_points=JSON.parse(manWE_points)}if(!manWE_points||(g_pageParams.adding==false&&!manWE_points[g_pageParams.pointUUID])){window.history.back()}$("img#manWE_online").attr("src",(g_onLine==true?g_basePath+"images/online.png":g_basePath+"images/offline.png"));volunteerRescue.populateFields(a,"manWE_");$("#manWE_coordinates").val(null);if(g_pageParams.adding==false){$("#manWE_description").val(manWE_points[g_pageParams.pointUUID].description);manWE_ptOne=new LatLon(manWE_points[g_pageParams.pointUUID].lat,manWE_points[g_pageParams.pointUUID].lon);vr_cc.displayCoordinates("#manWE_formatted",vr_cc.formatLatLon(manWE_points[g_pageParams.pointUUID].lat,manWE_points[g_pageParams.pointUUID].lon));manWE_mapManagePoints();$("#manWE_deleteForm").css("display","inline-block")}else{$("#manWE_description").val(null);$("#manWE_deleteForm").css("display","none");$.mobile.loading("show",{theme:"a",text:"Retrieving current position..."});vr_device.geolocation.getCurrentPosition(function(b){vr_cc.setCompassDesignators(b.coords.latitude,b.coords.longitude);manWE_ptOne=new LatLon(b.coords.latitude,b.coords.longitude);vr_cc.displayCoordinates("#manWE_formatted",vr_cc.formatLatLon(b.coords.latitude,b.coords.longitude));manWE_mapManagePoints();$.mobile.loading("hide");volunteerRescue.messageDialog("Information","<p>The retrieved position is accurate to "+Number(b.coords.accuracy).toFixed(2)+" metres.</p>",null)},function(b){$.mobile.loading("hide");volunteerRescue.messageDialog("Error","<p>Unable to determine current position:"+b.message+"</p>",null)},{enableHighAccuracy:true,maximumAge:30000,timeout:30000})}if(g_onLine==true){$("#manWE_btnShowMap").css("display","block")}$("#manWE_deleteForm").off("click",manWE_deleteClickHandler).on("click",manWE_deleteClickHandler);$("#manWE_submitForm").off("click",manWE_saveClickHandler).on("click",{apiResponse:a},manWE_saveClickHandler);$("#manWE_form").submit({apiResponse:a},manWE_saveClickHandler)});$("#manWE_coordinates").change(function(){var a=vr_cc.determineLatLon($(this).val());vr_cc.displayCoordinates("#manWE_formatted",vr_cc.formatLatLon(a.lat,a.lon));manWE_ptOne=new LatLon(a.lat,a.lon);manWE_mapManagePoints()});$("#manWE_btnShowMap").click(function(){$(this).remove();if(manWE_map==null){$("#manWE_mapCanvas").css("display","block");if(typeof google=="undefined"){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="https://maps-api-ssl.google.com/maps/api/js?key=AIzaSyBDQfGuTaIZxmRmQ5BCgZdQba8qoWdeUvY&sensor=false&callback=manWE_mapsApiLoaded";document.body.appendChild(a)}else{manWE_mapsApiLoaded()}}else{manWE_mapsApiLoaded()}return false});var manWE_mapsApiLoaded=function(){if(manWE_map==null){manWE_map=new google.maps.Map($("#manWE_mapCanvas")[0],{zoom:10,center:new google.maps.LatLng(0,0),mapTypeId:google.maps.MapTypeId.TERRAIN,panControl:false,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE},scaleControl:false});manWE_mkrOne=new google.maps.Marker({map:manWE_map,title:"First Point"})}if(manWE_map!=null){google.maps.event.addListener(manWE_map,"click",function(a){vr_cc.displayCoordinates("#manWE_formatted",vr_cc.formatLatLon(a.latLng.lat(),a.latLng.lng()));manWE_ptOne=new LatLon(a.latLng.lat(),a.latLng.lng());manWE_centerMap=false;manWE_mapManagePoints()});manWE_mapManagePoints()}};var manWE_mapManagePoints=function(){var a=null;if(manWE_map==null){return}a=new google.maps.LatLng(manWE_ptOne.lat(),manWE_ptOne.lon());manWE_mkrOne.setOptions({position:a,visible:true});if(manWE_centerMap==true){manWE_map.setCenter(manWE_mkrOne.getPosition())}else{manWE_centerMap=true}};