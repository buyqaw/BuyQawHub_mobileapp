/*! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   *
 *  Latitude/longitude spherical geodesy formulae & scripts (c) Chris Veness 2002-2012            *
 *   - www.movable-type.co.uk/scripts/latlong.html                                                *
 *                                                                                                *
 *  Sample usage:                                                                                 *
 *    var p1 = new LatLon(51.5136, -0.0983);                                                      *
 *    var p2 = new LatLon(51.4778, -0.0015);                                                      *
 *    var dist = p1.distanceTo(p2);          // in km                                             *
 *    var brng = p1.bearingTo(p2);           // in degrees clockwise from north                   *
 *    ... etc                                                                                     *
 * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */
;function LatLon(b,c,a){if(typeof(a)=="undefined"){a=6371}this._lat=typeof(b)=="number"?b:typeof(b)=="string"&&b.trim()!=""?+b:NaN;this._lon=typeof(c)=="number"?c:typeof(c)=="string"&&c.trim()!=""?+c:NaN;this._radius=typeof(a)=="number"?a:typeof(a)=="string"&&trim(c)!=""?+a:NaN}LatLon.prototype.distanceTo=function(o,h){if(typeof h=="undefined"){h=4}var g=this._radius;var f=this._lat.toRad(),j=this._lon.toRad();var e=o._lat.toRad(),i=o._lon.toRad();var l=e-f;var b=i-j;var n=Math.sin(l/2)*Math.sin(l/2)+Math.cos(f)*Math.cos(e)*Math.sin(b/2)*Math.sin(b/2);var m=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n));var k=g*m;return k.toPrecisionFixed(h)};LatLon.prototype.bearingTo=function(b){var f=this._lat.toRad(),e=b._lat.toRad();var c=(b._lon-this._lon).toRad();var g=Math.sin(c)*Math.cos(e);var a=Math.cos(f)*Math.sin(e)-Math.sin(f)*Math.cos(e)*Math.cos(c);var d=Math.atan2(g,a);return(d.toDeg()+360)%360};LatLon.prototype.finalBearingTo=function(b){var f=b._lat.toRad(),e=this._lat.toRad();var c=(this._lon-b._lon).toRad();var g=Math.sin(c)*Math.cos(e);var a=Math.cos(f)*Math.sin(e)-Math.sin(f)*Math.cos(e)*Math.cos(c);var d=Math.atan2(g,a);return(d.toDeg()+180)%360};LatLon.prototype.midpointTo=function(h){var d,c,b,f,e;d=this._lat.toRad(),f=this._lon.toRad();c=h._lat.toRad();var a=(h._lon-this._lon).toRad();var i=Math.cos(c)*Math.cos(a);var g=Math.cos(c)*Math.sin(a);b=Math.atan2(Math.sin(d)+Math.sin(c),Math.sqrt((Math.cos(d)+i)*(Math.cos(d)+i)+g*g));e=f+Math.atan2(g,Math.cos(d)+i);e=(e+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(b.toDeg(),e.toDeg())};LatLon.prototype.destinationPoint=function(a,f){f=typeof(f)=="number"?f:typeof(f)=="string"&&f.trim()!=""?+f:NaN;f=f/this._radius;a=a.toRad();var e=this._lat.toRad(),c=this._lon.toRad();var d=Math.asin(Math.sin(e)*Math.cos(f)+Math.cos(e)*Math.sin(f)*Math.cos(a));var b=c+Math.atan2(Math.sin(a)*Math.sin(f)*Math.cos(e),Math.cos(f)-Math.sin(e)*Math.sin(d));b=(b+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(d.toDeg(),b.toDeg())};LatLon.intersection=function(b,j,a,i){var f,e,d;var t,s,r;var g,m,l,k,c,v,u;var x,w,h,p;var q,o,n;j=typeof j=="number"?j:typeof j=="string"&&trim(j)!=""?+j:NaN;i=typeof i=="number"?i:typeof i=="string"&&trim(i)!=""?+i:NaN;f=b._lat.toRad(),t=b._lon.toRad();e=a._lat.toRad(),s=a._lon.toRad();g=j.toRad(),m=i.toRad();l=e-f,k=s-t;v=2*Math.asin(Math.sqrt(Math.sin(l/2)*Math.sin(l/2)+Math.cos(f)*Math.cos(e)*Math.sin(k/2)*Math.sin(k/2)));if(v==0){return null}x=Math.acos((Math.sin(e)-Math.sin(f)*Math.cos(v))/(Math.sin(v)*Math.cos(f)));if(isNaN(x)){x=0}w=Math.acos((Math.sin(f)-Math.sin(e)*Math.cos(v))/(Math.sin(v)*Math.cos(e)));if(Math.sin(s-t)>0){h=x;p=2*Math.PI-w}else{h=2*Math.PI-x;p=w}q=(g-h+Math.PI)%(2*Math.PI)-Math.PI;o=(p-m+Math.PI)%(2*Math.PI)-Math.PI;if(Math.sin(q)==0&&Math.sin(o)==0){return null}if(Math.sin(q)*Math.sin(o)<0){return null}n=Math.acos(-Math.cos(q)*Math.cos(o)+Math.sin(q)*Math.sin(o)*Math.cos(v));u=Math.atan2(Math.sin(v)*Math.sin(q)*Math.sin(o),Math.cos(o)+Math.cos(q)*Math.cos(n));d=Math.asin(Math.sin(f)*Math.cos(u)+Math.cos(f)*Math.sin(u)*Math.cos(g));c=Math.atan2(Math.sin(g)*Math.sin(u)*Math.cos(f),Math.cos(u)-Math.sin(f)*Math.sin(d));r=t+c;r=(r+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(d.toDeg(),r.toDeg())};LatLon.prototype.rhumbDistanceTo=function(i){var e=this._radius;var d=this._lat.toRad(),c=i._lat.toRad();var g=(i._lat-this._lat).toRad();var a=Math.abs(i._lon-this._lon).toRad();var f=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(d/2+Math.PI/4));var b=(isFinite(g/f))?g/f:Math.cos(d);if(Math.abs(a)>Math.PI){a=a>0?-(2*Math.PI-a):(2*Math.PI+a)}var h=Math.sqrt(g*g+b*b*a*a)*e;return h.toPrecisionFixed(4)};LatLon.prototype.rhumbBearingTo=function(a){var e=this._lat.toRad(),d=a._lat.toRad();var b=(a._lon-this._lon).toRad();var f=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(e/2+Math.PI/4));if(Math.abs(b)>Math.PI){b=b>0?-(2*Math.PI-b):(2*Math.PI+b)}var c=Math.atan2(b,f);return(c.toDeg()+360)%360};LatLon.prototype.rhumbDestinationPoint=function(g,m){var f=this._radius;var k=parseFloat(m)/f;var e=this._lat.toRad(),j=this._lon.toRad(),h;g=g.toRad();var l=k*Math.cos(g);if(Math.abs(l)<1e-10){l=0}var c=e+l;var i=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(e/2+Math.PI/4));var b=(isFinite(l/i))?l/i:Math.cos(e);var a=k*Math.sin(g)/b;if(Math.abs(c)>Math.PI/2){c=c>0?Math.PI-c:-Math.PI-c}h=(j+a+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(c.toDeg(),h.toDeg())};LatLon.prototype.rhumbMidpointTo=function(j){var f=this._lat.toRad(),i=this._lon.toRad();var d=j._lat.toRad(),h=j._lon.toRad();if(Math.abs(h-i)>Math.PI){i+=2*Math.PI}var c=(f+d)/2;var e=Math.tan(Math.PI/4+f/2);var b=Math.tan(Math.PI/4+d/2);var a=Math.tan(Math.PI/4+c/2);var g=((h-i)*Math.log(a)+i*Math.log(b)-h*Math.log(e))/Math.log(b/e);if(!isFinite(g)){g=(i+h)/2}g=(g+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(c.toDeg(),g.toDeg())};LatLon.prototype.lat=function(a,b){if(typeof a=="undefined"){return this._lat}return Geo.toLat(this._lat,a,b)};LatLon.prototype.lon=function(a,b){if(typeof a=="undefined"){return this._lon}return Geo.toLon(this._lon,a,b)};LatLon.prototype.toString=function(a,b){if(typeof a=="undefined"){a="dms"}return Geo.toLat(this._lat,a,b)+", "+Geo.toLon(this._lon,a,b)};if(typeof Number.prototype.toRad=="undefined"){Number.prototype.toRad=function(){return this*Math.PI/180}}if(typeof Number.prototype.toDeg=="undefined"){Number.prototype.toDeg=function(){return this*180/Math.PI}}if(typeof Number.prototype.toPrecisionFixed=="undefined"){Number.prototype.toPrecisionFixed=function(b){var c=this.toPrecision(b);var a;c=c.replace(/(.+)e\+(.+)/,function(f,e,d){e=e.replace(/\./,"");a=e.length-1;while(d-->a){e=e+"0"}return e});c=c.replace(/(.+)e-(.+)/,function(f,e,d){e=e.replace(/\./,"");while(d-->1){e="0"+e}return"0."+e});return c}}if(typeof String.prototype.trim=="undefined"){String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}var Geo={};Geo.parseDMS=function(b){if(typeof a=="object"){throw new TypeError("Geo.parseDMS - dmsStr is [DOM?] object")}if(typeof b==="number"&&isFinite(b)){return Number(b)}var c=String(b).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(c[c.length-1]==""){c.splice(c.length-1)}if(c==""){return NaN}switch(c.length){case 3:var a=c[0]/1+c[1]/60+c[2]/3600;break;case 2:var a=c[0]/1+c[1]/60;break;case 1:var a=c[0];break;default:return NaN}if(/^-|[WS]$/i.test(b.trim())){a=-a}return Number(a)};Geo.toDMS=function(a,i,c){var h;if(typeof a=="object"){throw new TypeError("Geo.toDMS - deg is [DOM?] object")}if(isNaN(a)){return null}if(typeof i=="undefined"){i="dms"}if(typeof c=="undefined"){switch(i){case"d":c=4;break;case"dm":c=2;break;case"dms":c=0;break;default:i="dms";c=0}}a=Math.abs(a);switch(i){case"d":g=a.toFixed(c);if(g<100){g="0"+g}if(g<10){g="0"+g}h=g+"\u00B0";break;case"dm":var e=(a*60).toFixed(c);var g=Math.floor(e/60);var b=(e%60).toFixed(c);if(g<100){g="0"+g}if(g<10){g="0"+g}if(b<10){b="0"+b}h=g+"\u00B0"+b+"\u2032";break;case"dms":var f=(a*3600).toFixed(c);var g=Math.floor(f/3600);var b=Math.floor(f/60)%60;var j=(f%60).toFixed(c);if(g<100){g="0"+g}if(g<10){g="0"+g}if(b<10){b="0"+b}if(j<10){j="0"+j}h=g+"\u00B0"+b+"\u2032"+j+"\u2033";break}return h};Geo.toLat=function(a,c,d){var b=Geo.toDMS(a,c,d);return b==null?"–":b.slice(1)+(a<0?"S":"N")};Geo.toLon=function(a,b,d){var c=Geo.toDMS(a,b,d);return c==null?"–":c+(a<0?"W":"E")};Geo.toBrng=function(b,c,d){b=(Number(b)+360)%360;var a=Geo.toDMS(b,c,d);return a==null?"–":a.replace("360","0")};