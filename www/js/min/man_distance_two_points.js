/*! VolunteerRescue | (c) 2012 - 2018 SKRPC Holdings, Inc. 
 * http://volunteerrescue.org/app_license
 */
;var manDTP_map=null;var manDTP_ptOne;var manDTP_ptTwo;var manDTP_mkrOne;var manDTP_mkrTwo;var manDTP_path;var manDTP_distance;var manDTP_mapClick=1;var manDTP_fitBounds=true;var manDTP_points=null;$("#manDTP_page").on("pageshow",function(){var c;var b;var a;vr_device.googleAnalytics();if(g_onLine==false){$("#manCC_divOffline").css("display","block")}manDTP_points=vr_device.localStorage.getItem("manWayPoints");if(!manDTP_points){manDTP_points=[]}else{manDTP_points=JSON.parse(manDTP_points)}b=$("#manDTP_waypointsOne");a=$("#manDTP_waypointsTwo");b.empty().append($('<option value="-1" selected>None</option>')).selectmenu("refresh",true);a.empty().append($('<option value="-1" selected>None</option>')).selectmenu("refresh",true);for(c in manDTP_points){b.append($('<option value="'+c+'">'+manDTP_points[c].description+"</option>"));a.append($('<option value="'+c+'">'+manDTP_points[c].description+"</option>"))}$("img#manDTP_online").attr("src",(g_onLine==true?g_basePath+"images/online.png":g_basePath+"images/offline.png"));if(vr_device.geolocation&&vr_device.geolocation.getCurrentPosition){$.mobile.loading("show",{theme:"a",text:"Retrieving current position..."});vr_device.geolocation.getCurrentPosition(function(d){var e;vr_cc.setCompassDesignators(d.coords.latitude,d.coords.longitude);e=vr_cc.formatLatLon(d.coords.latitude,d.coords.longitude);vr_cc.displayCoordinates("#manDTP_p1_formatted",e);vr_cc.displayCoordinates("#manDTP_p2_formatted",e);manDTP_ptOne=new LatLon(d.coords.latitude,d.coords.longitude);manDTP_ptTwo=new LatLon(d.coords.latitude,d.coords.longitude);$.mobile.loading("hide");volunteerRescue.messageDialog("Information","<p>The retrieved position is accurate to "+Number(d.coords.accuracy).toFixed(2)+" metres.</p>",null)},function(d){$.mobile.loading("hide");volunteerRescue.messageDialog("Error","<p>Unable to determine current position:"+d.message+"</p>",null)},{enableHighAccuracy:true,maximumAge:30000,timeout:30000})}});$("#manDTP_waypointsOne").change(function(){var a=$(this).val();if(a!=-1){manDTP_ptOne=new LatLon(manDTP_points[a].lat,manDTP_points[a].lon);vr_cc.displayCoordinates("#manDTP_p1_formatted",vr_cc.formatLatLon(manDTP_points[a].lat,manDTP_points[a].lon));manDTP_calculate()}});$("#manDTP_waypointsTwo").change(function(){var a=$(this).val();if(a!=-1){manDTP_ptTwo=new LatLon(manDTP_points[a].lat,manDTP_points[a].lon);vr_cc.displayCoordinates("#manDTP_p2_formatted",vr_cc.formatLatLon(manDTP_points[a].lat,manDTP_points[a].lon));manDTP_calculate()}});$("#manDTP_p1_coordinates").change(function(){var a=vr_cc.determineLatLon($(this).val());manDTP_ptOne=new LatLon(a.lat,a.lon);vr_cc.displayCoordinates("#manDTP_p1_formatted",vr_cc.formatLatLon(a.lat,a.lon));manDTP_calculate()});$("#manDTP_p2_coordinates").change(function(){var a=vr_cc.determineLatLon($(this).val());manDTP_ptTwo=new LatLon(a.lat,a.lon);vr_cc.displayCoordinates("#manDTP_p2_formatted",vr_cc.formatLatLon(a.lat,a.lon));manDTP_calculate()});$("#manDTP_btnShowMap").click(function(){$(this).remove();if(manDTP_map==null){$("#manDTP_mapCanvas").css("display","block");if(typeof google=="undefined"){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="https://maps-api-ssl.google.com/maps/api/js?key=AIzaSyBDQfGuTaIZxmRmQ5BCgZdQba8qoWdeUvY&sensor=false&callback=manDTP_mapsApiLoaded";document.body.appendChild(a)}else{manDTP_mapsApiLoaded()}}else{manDTP_mapsApiLoaded()}return false});$("#manDTP_btnReset").click(function(){$("#manDTP_cumulativeDistance").html($("#manDTP_distance").html())});var manDTP_calculate=function(){manDTP_distance=manDTP_ptOne.distanceTo(manDTP_ptTwo);if(!isNaN(manDTP_distance)){$("#manDTP_distance").html(manDTP_distance);$("#manDTP_cumulativeDistance").html(Number(Number(manDTP_distance)+Number($("#manDTP_cumulativeDistance").html())).toFixed(2));$("#manDTP_bearingInitial").html(Geo.toBrng(manDTP_ptOne.bearingTo(manDTP_ptTwo),"dms"));$("#manDTP_bearingFinal").html(Geo.toBrng(manDTP_ptOne.finalBearingTo(manDTP_ptTwo),"dms"));if(g_onLine==true&&manDTP_map==null){$("#manDTP_btnShowMap").css("display","block")}}else{$("#manDTP_distance").html(null);$("#manDTP_cumulativeDistance").html(null);$("#manDTP_bearingInitial").html(null);$("#manDTP_bearingFinal").html(null);if(g_onLine==true&&manDTP_map==null){$("#manDTP_btnShowMap").css("display","none")}}manDTP_mapManagePoints()};var manDTP_mapsApiLoaded=function(){if(manDTP_map==null){manDTP_map=new google.maps.Map($("#manDTP_mapCanvas")[0],{zoom:10,center:new google.maps.LatLng(0,0),mapTypeId:google.maps.MapTypeId.TERRAIN,panControl:false,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE},scaleControl:false});manDTP_mkrOne=new google.maps.Marker({map:manDTP_map,title:"First Point"});manDTP_mkrTwo=new google.maps.Marker({map:manDTP_map,title:"Second Point"});manDTP_path=new google.maps.Polyline({map:manDTP_map,strokeColor:"#990000",geodesic:true})}if(manDTP_map!=null){google.maps.event.addListener(manDTP_map,"click",function(a){manDTP_fitBounds=false;if(manDTP_mapClick==1){manDTP_ptOne=new LatLon(a.latLng.lat(),a.latLng.lng());vr_cc.displayCoordinates("#manDTP_p1_formatted",vr_cc.formatLatLon(manDTP_ptOne.lat(),manDTP_ptOne.lon()));manDTP_mapClick=2}else{manDTP_ptTwo=new LatLon(a.latLng.lat(),a.latLng.lng());vr_cc.displayCoordinates("#manDTP_p2_formatted",vr_cc.formatLatLon(manDTP_ptTwo.lat(),manDTP_ptTwo.lon()));manDTP_mapClick=1}manDTP_calculate()});manDTP_mapManagePoints()}};var manDTP_mapManagePoints=function(){var b=[];var a;if(manDTP_map==null){return}if(!isNaN(manDTP_distance)){a=new google.maps.LatLngBounds();b[0]=new google.maps.LatLng(manDTP_ptOne.lat(),manDTP_ptOne.lon());b[1]=new google.maps.LatLng(manDTP_ptTwo.lat(),manDTP_ptTwo.lon());a.extend(b[0]);a.extend(b[1]);manDTP_mkrOne.setOptions({position:b[0],visible:true});manDTP_mkrTwo.setOptions({position:b[1],visible:true});manDTP_path.setOptions({path:[b[0],b[1]],visible:true});if(manDTP_fitBounds==true){manDTP_map.fitBounds(a)}else{manDTP_fitBounds=true}}else{manDTP_mkrOne.setVisible(false);manDTP_mkrTwo.setVisible(false);manDTP_path.setVisible(false)}};